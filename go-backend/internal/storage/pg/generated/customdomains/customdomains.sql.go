// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: customdomains.sql

package customdomains

import (
	"context"
)

const createCustomDomain = `-- name: CreateCustomDomain :one
INSERT INTO custom_domains (service_id, domain, expected_record_target)
VALUES ($1, $2, $3) RETURNING id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at
`

type CreateCustomDomainParams struct {
	ServiceID            string `json:"service_id"`
	Domain               string `json:"domain"`
	ExpectedRecordTarget string `json:"expected_record_target"`
}

func (q *Queries) CreateCustomDomain(ctx context.Context, arg CreateCustomDomainParams) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, createCustomDomain, arg.ServiceID, arg.Domain, arg.ExpectedRecordTarget)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const delete = `-- name: Delete :exec
DELETE FROM custom_domains WHERE id = $1
`

func (q *Queries) Delete(ctx context.Context, id string) error {
	_, err := q.db.Exec(ctx, delete, id)
	return err
}

const deleteByServiceID = `-- name: DeleteByServiceID :exec
DELETE FROM custom_domains WHERE service_id = $1
`

func (q *Queries) DeleteByServiceID(ctx context.Context, serviceID string) error {
	_, err := q.db.Exec(ctx, deleteByServiceID, serviceID)
	return err
}

const expireStale = `-- name: ExpireStale :exec
UPDATE custom_domains SET status = 'failed', last_error = 'expired', updated_at = NOW()
WHERE status = 'pending_dns' AND expires_at < NOW()
`

func (q *Queries) ExpireStale(ctx context.Context) error {
	_, err := q.db.Exec(ctx, expireStale)
	return err
}

const getByDomain = `-- name: GetByDomain :one
SELECT id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at FROM custom_domains WHERE lower(domain) = lower($1)
`

func (q *Queries) GetByDomain(ctx context.Context, lower string) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, getByDomain, lower)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getByServiceID = `-- name: GetByServiceID :one
SELECT id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at FROM custom_domains WHERE service_id = $1
`

func (q *Queries) GetByServiceID(ctx context.Context, serviceID string) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, getByServiceID, serviceID)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateError = `-- name: UpdateError :one
UPDATE custom_domains SET last_error = $2, last_checked_at = NOW(), updated_at = NOW()
WHERE id = $1 RETURNING id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at
`

type UpdateErrorParams struct {
	ID        string  `json:"id"`
	LastError *string `json:"last_error"`
}

func (q *Queries) UpdateError(ctx context.Context, arg UpdateErrorParams) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, updateError, arg.ID, arg.LastError)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateStatus = `-- name: UpdateStatus :one
UPDATE custom_domains SET status = $2, last_checked_at = NOW(), updated_at = NOW()
WHERE id = $1 RETURNING id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at
`

type UpdateStatusParams struct {
	ID     string `json:"id"`
	Status string `json:"status"`
}

func (q *Queries) UpdateStatus(ctx context.Context, arg UpdateStatusParams) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, updateStatus, arg.ID, arg.Status)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const updateVerified = `-- name: UpdateVerified :one
UPDATE custom_domains SET status = 'active', verified_at = NOW(), updated_at = NOW()
WHERE id = $1 RETURNING id, service_id, domain, status, expected_record_target, expires_at, verified_at, last_checked_at, last_error, created_at, updated_at
`

func (q *Queries) UpdateVerified(ctx context.Context, id string) (CustomDomain, error) {
	row := q.db.QueryRow(ctx, updateVerified, id)
	var i CustomDomain
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.Domain,
		&i.Status,
		&i.ExpectedRecordTarget,
		&i.ExpiresAt,
		&i.VerifiedAt,
		&i.LastCheckedAt,
		&i.LastError,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
